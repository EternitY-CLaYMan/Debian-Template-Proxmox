{
    "description": "Debian 11 (bulleyes)",
    "variables": {
        "proxmox_url": "{{env `proxmox_url`}}",
        "proxmox_vm_storage": "{{env `proxmox_vm_storage`}}",
        "proxmox_iso_storage": "{{env `proxmox_iso_storage`}}",
        "proxmox_iso_checksum": "{{env `proxmox_iso_checksum`}}",
        "proxmox_node": "{{env `proxmox_node`}}",
        "proxmox_username": "{{env `proxmox_username`}}",
        "proxmox_iso_url": "{{env `proxmox_iso_url`}}",
        "proxmox_password": "{{env `proxmox_password`}}",
        "vm_id": "{{env `vm_id`}}",
        "vm_name": "{{env `vm_name`}}",
        "template_description": "{{env `template_description`}}",
        "vm_default_user": "{{env `vm_default_user`}}",
        "vm_cpu": "{{env `vm_cpu`}}",
        "vm_disk": "{{env `vm_disk`}}",
        "vm_memory": "{{env `vm_memory`}}",
        "ssh_username": "root",
        "ssh_password": "{{env `ssh_password`}}",
	      "proxmox_storage": "{{env `proxmox_storage`}}",
	      "proxmox_network": "{{env `proxmox_network`}}"
    },
    "sensitive-variables": ["proxmox_password", "ssh_password" ],
    "builders": [
        {
            "type": "proxmox",
            "proxmox_url":  "{{user `proxmox_url`}}",
            "node": "{{user `proxmox_node`}}",
            "insecure_skip_tls_verify": true,
            "username": "{{user `proxmox_username`}}",
            "password": "{{user `proxmox_password`}}",
            "template_description":"{{user `template_description`}}",
            "vm_id":  "{{user `vm_id`}}",
            "vm_name": "{{user `vm_name`}}",
            "memory": "{{user `vm_memory`}}",
            "cores": "{{user `vm_cpu`}}",
            "os": "l26",

            "http_directory": "http",

            "network_adapters": [
              {
                "model": "virtio",
                "bridge": "{{user `proxmox_network`}}"
              }
            ],

            "disks": [
              {
                "type": "virtio",
                "disk_size": "{{user `vm_disk`}}",
                "storage_pool": "{{ user `proxmox_vm_storage`}}",
                "storage_pool_type": "directory",
                "format": "raw"
              }
            ],
            "qemu_agent": "true",
            "ssh_username": "{{user `ssh_username`}}",
            "ssh_password": "{{user `ssh_password`}}",
            "ssh_timeout": "30m",
            "iso_url": "{{user `proxmox_iso_url`}}",  
            "iso_storage_pool": "{{user `proxmox_iso_storage`}}",  
            "iso_checksum": "{{user `proxmox_iso_checksum`}}",
            "unmount_iso": true,
            "boot_wait": "10s",
            "boot_command": [
                "<esc><wait>",
                "auto <wait>",
                "console-keymaps-at/keymap=fr <wait>",
                "console-setup/ask_detect=false <wait>",
                "debconf/frontend=noninteractive <wait>",
                "debian-installer=fr_FR <wait>",
                "fb=false <wait>",
                "install <wait>",
		            "packer_host={{ .HTTPIP }} <wait>",
		            "packer_port={{ .HTTPPort }} <wait>",
                "kbd-chooser/method=fr <wait>",
                "keyboard-configuration/xkb-keymap=fr <wait>",
                "locale=fr_FR <wait>",
                "netcfg/get_hostname={{user `vm_name`}} <wait>",
                "preseed/url=http://{{ .HTTPIP }}:{{ .HTTPPort }}/preseed.cfg <wait>",
                "<enter><wait>"
            ]
        }
    ],
    "provisioners": [
     {
      "type": "ansible",
      "ansible_env_vars": [ "ANSIBLE_FORCE_COLOR=1","ANSIBLE_HOST_KEY_CHECKING=False" ],
      "playbook_file": "ansible/provisioning.yml"
     }
    ]
}

